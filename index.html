<html>

	<head>
		<title>berta 3D</title>

		<style>
			body{margin: 0}
			canvas {width: 50%; height: 50%;}
		</style>
	</head>

	<body>

		<script src="js/three.js"></script>

        <script type="module" src="js/FirstPersonControls.js"></script>

		<script type="module" src="js/GLTFLoader.js"></script>
        <script type="module" src="js/FontLoader.js"></script>
        <script type="module" src="js/TextGeometry.js"></script>

        <script type="module">

            import {GLTFLoader} from "./js/GLTFLoader.js";
            import {FontLoader} from "./js/FontLoader.js";
            import {TextGeometry} from "./js/TextGeometry.js";
            import {FirstPersonControls} from "./js/FirstPersonControls.js";

            //////////////////////////////// Def scene //////////////////////////////////

            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera( //fov, aspect, near, far
                85, 
                window.innerWidth/window.innerHeight, 
                .01, 
                25);

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);

            document.body.appendChild(renderer.domElement);


            scene.background = new THREE.Color(0x696969); // Helps for initial testing

            var light = new THREE.HemisphereLight(0xffffff, 0x000000, 2); // 1st color, 2nd color, intensity
            light.position.set(5,6,7)
            scene.add(light);


            //////////////////// Loading up the 3D model (AKA Berta) //////////////////////

			var loader = new GLTFLoader();
            var obj;
			loader.load('assets/first_hall_dummy1.glb', function (gltf) {
                obj = gltf.scene;
                //obj.rotation.x = Math.PI / 7; // for nicer initial static viewing
                scene.add(gltf.scene);
			}, undefined, function ( error ) {
			console.error( error );
			} );

            ////////////////////// Add sector names (3d text) ////////////////////////////

            var txtLoader = new FontLoader();
            txtLoader.load('./fonts/RepublicaMinor2.0_Regular.json', function(font) {
                var txtGeometry = new TextGeometry('THE CAVE',{
                    font: font,
                    size:0.4,
                    height:0.2}) // thickness in depth

                var txtMesh = new THREE.Mesh(txtGeometry, [
                    new THREE.MeshPhongMaterial({color: 0x654ce7}),
                    new THREE.MeshPhongMaterial({color: 0x0c091c}),
                    ])    

                txtMesh.castShadow = true;

                txtMesh.position.set(9.5,5.2,-3.2);
                txtMesh.rotation.y = Math.PI * 1.7;
                scene.add(txtMesh);
            });

            ///////////////////////// First person camera & control//////////////////////

            camera.position.set(-4,2,0);

            // Setting up first person control of camera
            var controls = new FirstPersonControls(camera);
            controls.lookSpeed = 0.01;
            controls.movementSpeed = 5;


            var step = 0;
            var stepy = 0;

            var clock = new THREE.Clock();

            function renderScene() {
                step += 0.005;
                stepy += 0.00005;
                var delta = clock.getDelta();

                controls.update(delta);
                renderer.clear();

                requestAnimationFrame(renderScene);
                renderer.render(scene, camera);
            }

            /////////////////////////////////////////////////////////////////////////////
            
            renderScene();

            ////// First try (success) - render scene
            // camera.position.set(0,0,18);

            // function animate() {
            //     requestAnimationFrame(animate);
            //     renderer.render(scene, camera);
            // }

            // animate();

		</script>

	</body>

</html>